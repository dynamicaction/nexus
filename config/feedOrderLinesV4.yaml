---
feedJobName: feedOrderLinesV4
feedOutput: feedOrderLines
sankeyWidth: 4000
flows:
  ### Flow that reads in all fragItemProductLkup files
  - flowId: fragItemProductLkup_Merge
    flowInputs:
      - fragItemProductLkup
    schema:
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - item_id
          aggregationOperations:
            - { columnName: product_id, operation: last() }

  ### Flow which brings in the fragOrderLinesPlacedTimestamp fragments
  - flowId: fragOrderLinesPlacedTimestamp_Merge
    flowInputs:
      - fragOrderLinesPlacedTimestamp
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - order_id
          aggregationOperations:
            - {columnName: placed_timestamp, operation: max()}

###  ### Flow that reads in all fragTransOrderIdWa files
###  - flowId: fragTransOrderIdWa Merge
###    flowInputs:
###      - fragTransOrderIdWa
###    flowSteps:
###      - type: AGGREGATION
###        flowStepInputs:
###          - fragTransOrderIdWa
###        columns:
###          - {columnName: waOrderId}
###        operations:
###          - {columnName: order_id, operation: last()}
###    flowSchema:
###      - { columnName: waOrderId, columnType: string }
###      - { columnName: order_id, columnType: string }
###
###  ### Flow that reads in all fragTransOrderLineIdWa files
###  - flowId: fragTransOrderLineIdWa Merge
###    flowInputs:
###      - fragTransOrderLineIdWa
###    flowSteps:
###      - type: AGGREGATION
###        flowStepInputs:
###          - fragTransOrderLineIdWa
###        columns:
###          - {columnName: waOrderId}
###          - {columnName: waOrderLineId}
###        operations:
###          - {columnName: order_id, operation: last()}
###          - {columnName: orderLineId, operation: last()}
###    flowSchema:
###      - { columnName: waOrderId, columnType: string }
###      - { columnName: waOrderLineId, columnType: string }
###      - { columnName: order_id, columnType: string }
###      - { columnName: orderLineId, columnType: string }

  ### Flow that aggregates fragOrderLinesShipments
  - flowId: fragOrderLinesShipments_Merge
    flowInputs:
      - fragOrderLinesShipments
###            - fragTransOrderIdWa_Merge
###            - fragTransOrderLineIdWa_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: shipment_promise_date_ref, columnType: integer }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_date_ref, columnType: integer }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_date_ref, columnType: integer }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: originalDateTime, columnType: date }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - orderLineId
            - order_id
          aggregationOperations:
          - { columnName: shipping_amount, operation: last() }
          - { columnName: shipping_ex_tax, operation: last() }
          - { columnName: shipping_cost, operation: last() }
          - { columnName: shipping_country, operation: last() }
          - { columnName: shipping_region, operation: last() }
          - { columnName: shipping_postal_code, operation: last() }
          - { columnName: shipping_method, operation: last() }
          - { columnName: delivery_location_type, operation: last() }
          - { columnName: shipment_promise_timestamp, operation: last() }
          - { columnName: shipment_promise_date_ref, operation: last() }
          - { columnName: delivery_promise_timestamp, operation: last() }
          - { columnName: delivery_promise_date_ref, operation: last() }
          - { columnName: pick_up_in_store_promise_timestamp, operation: last() }
          - { columnName: pick_up_in_store_promise_date_ref, operation: last() }
          - { columnName: is_free_shipping, operation: last() }
          - { columnName: is_express_shipping, operation: last() }
          - { columnName: pick_pack_cost, operation: last() }
          - { columnName: originalDateTime, operation: last() }
          - { columnName: order_id_type, operation: last() }

  - flowId: tempOrderIdSales ##Weighted Average File based on fragOrderLines
    flowInputs:
      - fragOrderLines
    schema:
      - { columnName: orderLineId, columnType: integer }
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: sales, columnType: double }
      - { columnName: count, columnType: integer }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - sales
            - count
          aggregationOperations:
            - { columnName: sales, operation: sum() }
            - { columnName: count, operation: count() }

  - flowId: tempOrderSales ##Weighted Average Files base on fragOrderLines
    flowInputs:
      - fragOrderLines
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: count, columnType: integer }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - sales
            - count
          aggregationOperations:
            - { columnName: sales, operation: sum() }
            - { columnName: count, operation: count() }

  - flowId: fragBusinessCalendar_Merge ##tempBusinessCalendar
    flowInputs:
      - fragBusinessCalendar
    schema:
      - { columnName: date, columnType: date }
      - { columnName: workingDay, columnType: boolean }
    flowSteps:
      - type: MARKDOWN
        logic: "\n
        **fragBusinessCalendar schema**\n
        \n
        - date\n
        - dayOffset\n
        \n
        -----
        \n
        **Core Flow Merge**\n
        \n
        Data from this step determines the dayOffset used to calculate if the day in question is a day the client ships.\n"

  - flowId: fragShippingCost_Merge ##tempShippingCost
    flowInputs:
      - fragShippingCost
    schema:
      - { columnName: shippingPartner, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: deliveryCountry, columnType: string }
      - { columnName: deliveryRegion, columnType: string }
      - { columnName: matchType, columnType: string }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shippingPromiseOffset, columnType: integer }
      - { columnName: applyType, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - shipping_method
            - deliveryCountry
            - deliveryRegion
            - matchType
          aggregationOperations:
            - { columnName: shipping_cost, operation: last() }
            - { columnName: shippingPromiseOffset, operation: last() }
            - { columnName: shippingPartner, operation: last() }
            - { columnName: applyType, operation: last() }

  - flowId: fragOrderLinesPromos_Merge ##tempOrderLinesPromos
    flowInputs:
      - fragOrderLinesPromos
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: promo_info, columnType: string }
      - { columnName: promoAmount, columnType: double }
      - { columnName: subtractFromSales, columnType: boolean }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - orderLineId
            - order_id
            - item_id
            - product_id
            - quantity
          aggregationOperations:
            - { columnName: promo_info, operation: list() }
            - { columnName: promoAmount, operation: sum() }
            - { columnName: subtractFromSales, operation: last() }

  - flowId: fragOrderLinesItemPromos_Merge ##tempOrderLinesItemPromos
    flowInputs:
      - fragOrderLinesItemPromos
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: promo_info, columnType: string }
      - { columnName: subtractAmount, columnType: double }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - order_id
            - item_id
          aggregationOperations:
            - { columnName: promo_info, operation: list() }
            - { columnName: subtractAmount, operation: sum() }

  - flowId: fragOrderLinesOtherPromoCost_Merge ##tempOrderLinesOtherPromoCost
    flowInputs:
      - fragOrderLinesOtherPromoCost
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: other_promo_cost, columnType: double }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - orderLineId
            - order_id
            - item_id
            - product_id
            - quantity
          aggregationOperations:
            - { columnName: other_promo_cost, operation: sum() }

  - flowId: fragOrderLinesInventoryFlags_Merge ##tempOrderLinesInventoryFlags
    flowInputs:
      - fragOrderLinesInventoryFlags
    schema:
      - { columnName: item_id, columnType: string }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - item_id
          aggregationOperations:
            - { columnName: is_backorder, operation: first() }
            - { columnName: is_preorder, operation: first() }
            - { columnName: is_ship_from_vendor, operation: first() }

  - flowId: fragProductInventoryCost_Merge ##tempProductInventoryCost
    flowInputs:
      - fragProductInventoryCost
    schema:
      - { columnName: date, columnType: date }
      - { columnName: product_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: site, columnType: string }
      - { columnName: unit_cost, columnType: float }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - date
            - item_id
            - site
          aggregationOperations:
            - { columnName: product_id, operation: last() }
            - { columnName: unit_cost, operation: last() }

  - flowId: fragProductSample_Merge ##tempProductSample
    flowInputs:
      - fragProductSample
    schema:
      - { columnName: item_id, columnType: string }
      - { columnName: cost, columnType: double }
      - { columnName: promoName, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - order_id
            - orderLineId
          aggregationOperations:
            - { columnName: cost, operation: last() }
            - { columnName: promoName, operation: last() }

  - flowId: fragOrderLinesSamples_Merge ##tempOrderLinesSample
    flowInputs:
      - fragOrderLinesSamples
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: cost, columnType: double }
      - { columnName: promoType, columnType: string }
      - { columnName: promoName, columnType: string }
      - { columnName: isSample, columnType: boolean }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - orderLineId
            - order_id
            - item_id
          aggregationOperations:
            - { columnName: cost, operation: last() }
            - { columnName: promoType, operation: last() }
            - { columnName: promoName, operation: last() }
            - { columnName: isSample, operation: last() }

  - flowId: fragAttributeValueLkup_Merge ##tempAttributeValueLkup
    flowInputs:
      - fragAttributeValueLkup
    schema:
      - { columnName: attributeNumber, columnType: integer }
      - { columnName: lookup, columnType: string }
      - { columnName: value, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - attributeNumber
            - lookup
          aggregationOperations:
            - { columnName: value, operation: last() }

  - flowId: fragShippingCountryLkup_Merge ##tempShippingCountryLkup
    flowInputs:
      - fragShippingCountryLkup
    schema:
      - { columnName: shipping_country, columnType: string }
      - { columnName: shippingCountryLkup, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - shipping_country
          aggregationOperations:
            - { columnName: shippingCountryLkup, operation: last() }

  - flowId: fragShippingOffsetLkup_Merge ##tempShippingOffsetLkup
    flowInputs:
      - fragShippingOffsetLkup
    schema:

      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: shippingOffset, columnType: integer }
      - { columnName: deliveryOffset, columnType: integer }
      - { columnName: pickUpInStoreOffset, columnType: integer }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - shipping_country
            - shipping_method
          aggregationOperations:
            - { columnName: shippingOffset, operation: min() }
            - { columnName: deliveryOffset, operation: min() }
            - { columnName: deliveryOffset, operation: min() }

  - flowId: fragOrdersRef_Merge  ##tempOrdersRef
    flowInputs:
      - fragOrdersRef
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: web_order_id, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - order_id
          aggregationOperations:
            - { columnName: web_order_id, operation: last() }

  - flowId: fragOmsProductId_Merge  ##tempOmsProductId
    flowInputs:
      - fragOmsProductId
    schema:
      - { columnName: omsProductId, columnType: string }
      - { columnName: product_id, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - product_id
          aggregationOperations:
            - { columnName: product_id, operation: last() }

  - flowId: fragOmsItemId_Merge  ##tempOmsItemId
    flowInputs:
      - fragOmsItemId
    schema:
      - { columnName: omsItemId, columnType: string }
      - { columnName: item_id, columnType: string }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - omsItemId
          aggregationOperations:
            - { columnName: item_id, operation: last() }

  - flowId: fragCurrencyConversionRates_Merge  ##tempCurrencyConversionRates
    flowInputs:
      - fragCurrencyConversionRates
    schema:
      - { columnName: date, columnType: date }
      - { columnName: currency_code, columnType: string }
      - { columnName: conversion_rate, columnType: double }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - currency_code
          aggregationOperations:
            - { columnName: date, operation: last() }
            - { columnName: conversion_rate, operation: last() }

### TMaps

  - flowId: fragItemProductLkup_CoreFlowJoin_5
    flowInputs:
      - fragItemProductLkup_Merge
      - fragOrderLines
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: double }
      - { columnName: current_price, columnType: double }
      - { columnName: full_price, columnType: double }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLines
            - fragItemProductLkup_Merge
          joinColumns:
            - item_id
          joinOperations:
            - {columnName: product_id, operation: item_id is not null}

  - flowId: fragOrderLinesPlacedTS_CoreFLowJoin_2
    flowInputs:
      - fragOrderLinesPlacedTimestamp_Merge
      - fragItemProductLkup_CoreFlowJoin_5
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: double }
      - { columnName: current_price, columnType: double }
      - { columnName: full_price, columnType: double }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesPlacedTimestamp_Merge
            - fragItemProductLkup_CoreFlowJoin_5
          joinColumns:
            - order_id
          joinOperations:
            - {columnName: placed_timestamp, operation: order_id is not null}

  - flowId: fragOrderLinesShipments_ItemProdLkup_30
    flowInputs:
      - fragOrderLinesShipments_Merge
      - fragItemProductLkup_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: shipment_promise_date_ref, columnType: integer }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_date_ref, columnType: integer }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_date_ref, columnType: integer }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: originalDateTime, columnType: date }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesShipments_Merge
            - fragItemProductLkup_Merge
          joinColumns:
            - item_id
          joinOperations:
          - {columnName: product_id, operation: 'item_id is not null'}

  - flowId: fragOrderLinesShipments_CoreFlowJoin_7
    flowInputs:
      - fragOrderLinesPlacedTS_CoreFLowJoin_2
      - fragOrderLinesShipments_ItemProdLkup_30
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesPlacedTS_CoreFLowJoin_2
            - fragOrderLinesShipments_ItemProdLkup_30
          joinColumns:
            - orderLineId
            - order_id
            - item_id
            - product_id
            - quantity
          joinOperations:
            - { columnName: shipping_amount, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipping_ex_tax, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipping_cost, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipping_country, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipping_region, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipping_postal_code, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipping_method, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: delivery_location_type, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: shipment_promise_timestamp, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: delivery_promise_timestamp, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: pick_up_in_store_promise_timestamp, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: is_free_shipping, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: is_express_shipping, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: pick_pack_cost, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}

  - flowId: fragShippingCost_ItemProductLkup_32
    flowInputs:
      - tempOrderIdSales
      - fragItemProductLkup_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: sales, columnType: double }
      - { columnName: count, columnType: integer }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - tempOrderIdSales
            - fragItemProductLkup_Merge
          joinColumns:
            - item_id
          joinOperations:
            - { columnName: product_id, operation: item_id is not null}

  - flowId: fragShippingCost_CoreFlowJoin_16  ##Core Flow Order Lines for shipment and order data translations
    flowInputs:
      - fragOrderLinesShipments_CoreFlowJoin_7
      - fragShippingCost_ItemProductLkup_32
      - tempOrderSales
      - fragBusinessCalendar_Merge
      - fragShippingCost_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
      - { columnName: shipDateRef, columnType: integer }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesShipments_CoreFlowJoin_7
            - fragShippingCost_ItemProductLkup_32
            - tempOrderSales
            - fragBusinessCalendar_Merge
            - fragShippingCost_Merge
          joinColumns:
            - orderLineId (ShippingCost)
            - order_id (ShippingCost)
            - item_id (ShippingCost)
            - product_id (ShippingCost)
            - quantity (ShippingCost)
            - order_id (tempOrderSales)
            - placed_timestamp (calendar)
          joinOperations:
            - { columnName: shipping_cost (ShippingCost), operation: shipping_method is not null}
            - { columnName: shippingPromiseOffset (ShippingCost), operation: shipping_method is not null}
            - { columnName: applyType (ShippingCost), operation: shipping_method is not null}
            - { columnName: shipping_cost (ShippingCost), operation: 'shipping_country, shipping_region, shipping_method is not null'}
            - { columnName: shippingPromiseOffset (ShippingCost), operation: 'shipping_country, shipping_region, shipping_method is not null'}
            - { columnName: applyType (ShippingCost), operation: 'shipping_country, shipping_region, shipping_method is not null'}
            - { columnName: shipping_cost (ShippingCost), operation: 'shipping_country, shipping_region is not null'}
            - { columnName: shippingPromiseOffset (ShippingCost), operation: 'shipping_country, shipping_region is not null'}
            - { columnName: applyType (ShippingCost), operation: shipping_country  shipping_region is not null}
            - { columnName: shipping_cost (ShippingCost), operation: shipping_country is not null}
            - { columnName: shippingPromiseOffset (ShippingCost), operation: shipping_country is not null}
            - { columnName: applyType (ShippingCost), operation: shipping_country is not null}
            - { columnName: shipping_cost (ShippingCost), operation: shipping_country is not null}
            - { columnName: shippingPromiseOffset (ShippingCost), operation: shipping_country is not null}
            - { columnName: applyType (ShippingCost), operation: shipping_country is not null}
            - { columnName: sales (OrderIdSales), operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: count (OrderIdSales), operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: sales (tempOrderSales), operation: order_id is not null}
            - { columnName: count (tempOrderSales), operation: order_id is not null}
            - { columnName: date (calendar), operation: placed_timestamp is not null}
            - { columnName: dayOffset (calendar), operation: placed_timestamp is not null}

  - flowId: fragOrderLinesPromos_ItemProductLkup_33
    flowInputs:
      - fragItemProductLkup_Merge
      - fragOrderLinesPromos_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: promo_info, columnType: string }
      - { columnName: currency_code, columnType: string }
      - { columnName: promoAmount, columnType: double }
      - { columnName: subtractFromSales, columnType: boolean }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragItemProductLkup_Merge
            - fragOrderLinesPromos_Merge
          joinColumns:
            - item_id
          joinOperations:
            - { columnName: product_id, operation: item_id is not null}

  - flowId: fragOrderLinesPromos_CoreFlowJoin_9
    flowInputs:
      - fragBusinessCalendar_Merge
      - fragOrderLinesPromos_ItemProductLkup_33
      - fragShippingCost_CoreFlowJoin_16
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
      - { columnName: shipDateRef, columnType: integer }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragBusinessCalendar_Merge
            - fragOrderLinesPromos_ItemProductLkup_33
            - fragShippingCost_CoreFlowJoin_16
          joinColumns:
            - orderLineId
            - order_id
            - item_id
            - product_id
            - quantity
            - shipDateRef
          joinOperations:
            - { columnName: dateRef, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: promo_info, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: promoAmount, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}
            - { columnName: subtractFromSales, operation: shipDateRef is not null}

  - flowId: fragOrderLinesItemPromos_CoreFlowJoin_29
    flowInputs:
      - fragOrderLinesPromos_CoreFlowJoin_9
      - fragOrderLinesItemPromos_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesPromos_CoreFlowJoin_9
            - fragOrderLinesItemPromos_Merge
          joinColumns:
            - order_id
            - item_id
          joinOperations:
            - { columnName: promo_info, operation: order_id  item_id is not null}
            - { columnName: subtractAmount, operation: 'order_id, item_id is not null'}

  - flowId: fragOrderLinesInvFlags_CoreFlowJoin_35
    flowInputs:
      - fragOrderLinesItemPromos_CoreFlowJoin_29
      - fragOrderLinesInventoryFlags_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesItemPromos_CoreFlowJoin_29
            - fragOrderLinesInventoryFlags_Merge
          joinColumns:
            - item_id
          joinOperations:
            - { columnName: is_backorder, operation: item_id is not null }
            - { columnName: is_preorder, operation: item_id is not null }
            - { columnName: is_ship_from_vendor, operation: item_id is not null }

  - flowId: invCost_productSample_CoreFlowJoin_1
    flowInputs:
      - fragOrderLinesInvFlags_CoreFlowJoin_35
      - fragProductInventoryCost_Merge
      - fragProductSample_Merge
      - fragOrderLinesSamples_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesInvFlags_CoreFlowJoin_35
            - fragProductInventoryCost_Merge
            - fragProductSample_Merge
            - fragOrderLinesSamples_Merge
          joinColumns:
            - item_id (ProductSample)
            - item_id (ProductInventoryCost)
            - orderLineId (OrderLinesSample)
            - order_id (OrderLinesSample)
            - item_id (OrderLinesSample)
          joinOperations:
            - { columnName: item_id (ProductSample), operation: item_id is not null}
            - { columnName: cost (ProductSample), operation: 'item_id is not null'}
            - { columnName: item_id (ProductInventoryCost), operation: item_id is not null}
            - { columnName: unit_cost (ProductInventoryCost), operation: item_id is not null}
            - { columnName: item_id (OrderLineSample), operation: 'orderLineId, product_id, item_id is not null'}
            - { columnName: cost (OrderLineSample), operation: 'orderLineId, product_id, item_id is not null'}
            - { columnName: promoType (OrderLineSample), operation: 'orderLineId, product_id, item_id is not null'}
            - { columnName: promoName (OrderLineSample), operation: 'orderLineId, product_id, item_id is not null'}
            - { columnName: isSample (OrderLineSample), operation: 'orderLineId, product_id, item_id is not null'}

  - flowId: fragOrdLinesOthPromoCst_ItemProdLkup_23
    flowInputs:
      - fragItemProductLkup_Merge
      - fragOrderLinesOtherPromoCost_Merge
    schema:
      - { columnName: orderLineId, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: other_promo_cost, columnType: double }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragItemProductLkup_Merge
            - fragOrderLinesOtherPromoCost_Merge
          joinColumns:
            - item_id
          joinOperations:
            - { columnName: product_id, operation: item_id is not null}

  - flowId: fragOrdLinesOtherPromoCst_CoreFlowJoin_4
    flowInputs:
      - invCost_productSample_CoreFlowJoin_1
      - fragOrdLinesOthPromoCst_ItemProdLkup_23
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - invCost_productSample_CoreFlowJoin_1
            - fragOrdLinesOthPromoCst_ItemProdLkup_23
          joinColumns:
            - orderLineId
            - order_id
            - item_id
            - product_id
            - quantity
          joinOperations:
            - { columnName: other_promo_cost, operation: 'orderLineId, order_id, item_id, product_id, quantity is not null'}

  - flowId: fragAttributeValueLkup_CoreFlowJoin_25
    flowInputs:
      - fragOrdLinesOtherPromoCst_CoreFlowJoin_4
      - fragAttributeValueLkup_Merge
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrdLinesOtherPromoCst_CoreFlowJoin_4
            - fragAttributeValueLkup_Merge
          joinColumns:
            - order_line_attribute1
            - order_line_attribute2
            - order_line_attribute3
            - order_line_attribute4
            - order_line_attribute5
          joinOperations:
            - { columnName: value, operation: order_line_attribute1 is not null}
            - { columnName: value, operation: order_line_attribute2 is not null}
            - { columnName: value, operation: order_line_attribute3 is not null}
            - { columnName: value, operation: order_line_attribute4 is not null}
            - { columnName: value, operation: order_line_attribute5 is not null}

  - flowId: fragShippingCountryLkup_CoreFlowJoin_17
    flowInputs:
      - fragAttributeValueLkup_CoreFlowJoin_25
      - fragShippingCountryLkup_Merge
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragShippingCountryLkup_Merge
            - fragAttributeValueLkup_CoreFlowJoin_25
          joinColumns:
            - shipping_country
          joinOperations:
            - { columnName: shippingCountryLkup, operation: shipping_country is not null}

  - flowId: fragShippingOffsetLkup_CoreFlowJoin_31
    flowInputs:
      - fragShippingCountryLkup_CoreFlowJoin_17
      - fragShippingOffsetLkup_Merge
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragShippingCountryLkup_CoreFlowJoin_17
            - fragShippingOffsetLkup_Merge
          joinColumns:
            - shipping_country
            - shipping_method
          joinOperations:
            - { columnName: shippingOffset, operation: 'shipping_country, shipping_method is not null'}
            - { columnName: deliveryOffset, operation: 'shipping_country, shipping_method is not null'}
            - { columnName: pickupInStoreOffset, operation: 'shipping_country, shipping_method is not null'}

  - flowId: order_product_item_lkup_CoreFlowJoin_3  ##Core Flow Order Lines Orders/Product/Item Lookup
    flowInputs:
      - fragShippingOffsetLkup_CoreFlowJoin_31
      - fragOrdersRef_Merge
      - fragOmsProductId_Merge
      - fragOmsItemId_Merge
    schema:
      - { columnName: original_order_id, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrdersRef_Merge
            - fragOmsProductId_Merge
            - fragOmsItemId_Merge
          joinColumns:
            - order_id
            - product_id --> oms_product_id
            - item_id --> oms_item_id
          joinOperations:
            - { columnName: web_order_id, operation: order_id is not null}
            - { columnName: product_id, operation: oms_product_id is not null}
            - { columnName: item_id, operation: oms_item_id is not null}

  - flowId: fragCurrencyConvRate_CoreFlowJoin_22
    flowInputs:
      - order_product_item_lkup_CoreFlowJoin_3
      - fragCurrencyConversionRates_Merge
    schema:
      - { columnName: original_order_id, columnType: string }
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragCurrencyConversionRates_Merge
            - order_product_item_lkup_CoreFlowJoin_3
          joinColumns:
            - currency_code
          joinOperations:
            - { columnName: conversion_rate, operation: currency_code is not null}

  - flowId: orderLineId_Consolidation_14
    flowInputs:
      - fragCurrencyConvRate_CoreFlowJoin_22
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
      - { columnName: countUnitCost, columnType: integer }
      - { columnName: countCurrentPrice, columnType: integer }
      - { columnName: countFullPrice, columnType: integer }
    flowSteps:
      - type: "AGGREGATE"
        logic:
          aggregationColumns:
            - order_id
            - item_id
            - product_id
            - seller
            - currency_code
            - shipping_country
            - shipping_region
            - shipping_postal_code
            - shipping_method
            - delivery_location_type
            - price_currency_code
            - order_line_attribute1
            - order_line_attribute2
            - order_line_attribute3
            - order_line_attribute4
            - order_line_attribute5
          aggregationOperations:
            - { columnName: placed_timestamp, operation: first() }
            - { columnName: quantity, operation: sum() }
            - { columnName: sales, operation: sum() }
            - { columnName: sales_ex_tax, operation: sum() }
            - { columnName: promo_info, operation: list }
            - { columnName: other_promo_cost, operation: sum() }
            - { columnName: shipping_amount, operation: sum() }
            - { columnName: shipping_ex_tax, operation: sum() }
            - { columnName: shipping_cost, operation: sum() }
            - { columnName: shipment_promise_timestamp, operation: last }
            - { columnName: delivery_promise_timestamp, operation: last }
            - { columnName: pick_up_in_store_promise_timestamp, operation: last }
            - { columnName: is_free_shipping, operation: last }
            - { columnName: is_express_shipping, operation: last }
            - { columnName: pick_pack_cost, operation: sum() }
            - { columnName: is_backorder, operation: last }
            - { columnName: is_preorder, operation: last }
            - { columnName: is_ship_from_vendor, operation: last }
            - { columnName: is_free_sample, operation: last }
            - { columnName: unit_cost,  operation: sum() }
            - { columnName: current_price, operation: sum() }
            - { columnName: full_price, operation: sum() }
            - { columnName: countUnitCost, operation: sum() }
            - { columnName: countCurrentPrice, operation: sum() }
            - { columnName: countFullPrice, operation: sum() }

  - flowId: fragOrderLinesPromoTranslation_Merge_44
    flowInputs:
      - fragOrderLinesPromoTranslation
    schema:
      - { columnName: original, columnType: string }
      - { columnName: splitPromo, columnType: string }
      - { columnName: text, columnType: string }
      - { columnName: value, columnType: string }
      - { columnName: classIn, columnType: string }
      - { columnName: typeIn, columnType: string }
      - { columnName: nameIn, columnType: string }
      - { columnName: cnt, columnType: integer }
      - { columnName: position, columnType: integer }
      - { columnName: classOut, columnType: string }
      - { columnName: typeOut, columnType: string }
      - { columnName: nameOut, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesPromoTranslation
            - fragOrderLinesPromoTranslation (self-join)
          joinColumns:
            - classIn
            - typeIn
            - nameIn
          joinOperations:
            - { columnName: classOut, operation: classIn is not null}
            - { columnName: typeOut, operation: typeIn is not null}
            - { columnName: nameOut, operation: nameIn is not null}

  - flowId: fragOrdLinesPromoTrans_CoreFlowJoin_54
    flowInputs:
      - fragOrderLinesPromoTranslation_Merge_44
      - orderLineId_Consolidation_14
    schema:
      - { columnName: order_id, columnType: string }
      - { columnName: placed_timestamp, columnType: date }
      - { columnName: item_id, columnType: string }
      - { columnName: product_id, columnType: string }
      - { columnName: seller, columnType: string }
      - { columnName: quantity, columnType: integer }
      - { columnName: currency_code, columnType: string }
      - { columnName: sales, columnType: double }
      - { columnName: sales_ex_tax, columnType: double }
      - { columnName: promo_info, columnType: string }
      - { columnName: other_promo_cost, columnType: double }
      - { columnName: shipping_amount, columnType: double }
      - { columnName: shipping_ex_tax, columnType: double }
      - { columnName: shipping_cost, columnType: double }
      - { columnName: shipping_country, columnType: string }
      - { columnName: shipping_region, columnType: string }
      - { columnName: shipping_postal_code, columnType: string }
      - { columnName: shipping_method, columnType: string }
      - { columnName: delivery_location_type, columnType: string }
      - { columnName: shipment_promise_timestamp, columnType: date }
      - { columnName: delivery_promise_timestamp, columnType: date }
      - { columnName: pick_up_in_store_promise_timestamp, columnType: date }
      - { columnName: is_free_shipping, columnType: boolean }
      - { columnName: is_express_shipping, columnType: boolean }
      - { columnName: pick_pack_cost, columnType: double }
      - { columnName: is_backorder, columnType: boolean }
      - { columnName: is_preorder, columnType: boolean }
      - { columnName: is_ship_from_vendor, columnType: boolean }
      - { columnName: is_free_sample, columnType: boolean }
      - { columnName: unit_cost, columnType: float }
      - { columnName: current_price, columnType: float }
      - { columnName: full_price, columnType: float }
      - { columnName: price_currency_code, columnType: string }
      - { columnName: order_line_attribute1, columnType: string }
      - { columnName: order_line_attribute2, columnType: string }
      - { columnName: order_line_attribute3, columnType: string }
      - { columnName: order_line_attribute4, columnType: string }
      - { columnName: order_line_attribute5, columnType: string }
    flowSteps:
      - type: "JOIN"
        logic:
          joinInputs:
            - fragOrderLinesPromoTranslation_Merge_44
            - orderLineId_Consolidation_14
          joinColumns:
            - promoInfo
          joinOperations:
            - { columnName: translated, operation: translated is not null}


